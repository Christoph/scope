{% load staticfiles %}
<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>
.index_form {
	margin:auto;
  text-align: center;                        
  font-size: 100%;           
  border: None;
  width: auto;
  background: None;

}
    
.colophon2 {
	color: #818181;
	font-size: .7em;
	margin: 0 auto;
   /* max-width: 1300px;*/
    padding: 10px;
    padding-top: 10px;}
    
.menu-footer {
    background: #2b2b2b;
    width: 100%;}
.menu-left {
  float:left;
    width:420px;}
    
.menu-right {
  float:right;
  width:350px;
 }
circle {
  stroke: #fff;
  stroke-width: 1.5px;
  
}
.link {
  stroke: #999;
  stroke-opacity: .9;
}    
     svg {float: right;
        background: #fff;
        width: 80%;
        height:800px;
        }
    #order { margin: 25px;
}

    labels {position:relative;}
    rect{position:relative;}
    
text {
  font: 13px "Raleway", sans-serif;
    font-weight: bold;
  pointer-events: none;
  position:absolute;
    max-width: 50px;
  background-color:#fff;
  border-radius:3px;
    opacity: 1;
    border-style: solid;
    border: 2px;
}
    text a:link,
    text a:hover, 
    text a:visited {
        position:relative;
        bottom: 0px;
    color: #bbb; 
        vertical-align: bottom;
   }
box {
    position: absolute;
    top: 40px;
    width: 20%;
    height: 800px;
    float: left;
    color: #2b2b2b;
  border-color: #2b2b2b;
  border-style: solid;
  border: 2px;      
overflow: auto;
clear: both;}
    
suggest {   
  position: relative; 
  width: 85%;
  height: 15%;
  float: left;
  text-align: left;
  font: 18px "Raleway", sans-serif; 
  border: 2px;
  border-style: solid;
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: #fff;
      overflow:scroll; 
    clear:right;
    background-size: cover;
    text-shadow: #000 0px 0px 1px, #000 0px 0px 1px,   #000 0px 0px 1px,
             #000 0px 0px 1px,   #000 0px 0px 1px,   #000 0px 0px 1px;
    
    
} 
    suggest a:link,
    suggest a:hover, 
    suggest a:visited {
        position:relative;
        bottom: 0px;
    color: #fff; 
        vertical-align: bottom;
   }
    .suggestion{}
    
bottom_box {
    position: absolute;
    top: 550px;
    left: 21%;
    width: 75%;
    height: 250px;
    float: left;
    border-style: solid;
    border: 2px;   
    border-color: #ffff00;
    border-radius: 3px;
    background: #2b2b2b;
    padding: 20px;
    pointer-events:none;
    clear: both;}
    

bsuggest {   
  position: relative; 
  float: left;
  text-align: left;                        
  font: 15px "Raleway", sans-serif;  
  width: 33%;
  line-height: 1;
  padding: 12px;
  color: #fff;

}
        bsuggest a:link,
    bsuggest a:hover, 
    bsuggest a:visited {
        font-weight: bold;
    color: #fff; 
        
   }



div.tooltip {   
  position: absolute;
    float: left;
  text-align: left;                        
  font: 12px "Raleway", sans-serif;           
  border: 2px;
  width: 200px;
  border-radius: 8px;
  line-height: 1;
  padding: 12px;
  background: #fff;          
  pointer-events: none;
  color: #2b2b2b;
  border-color: #2b2b2b;
  border-style: solid;
}
    div.tooltip img{max-width:200px}
    
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 12px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}
 pop.popup {
     float: left;
  position: absolute;           
  text-align: left;                        
  font: 12px "Raleway", sans-serif;           
  border: 2px;
  width: 200px;
  border-radius: 8px;
  line-height: 1;
  padding: 12px;
  background: #fff;
  color: #2b2b2b;
  border-color: #2b2b2b;
  border-style: solid;
}  
pop.popup img{max-width:200px}
/* Creates a small triangle extender for the tooltip */
</style>

<head>

    <title>graphite | maximise relevance, minimise redundancy</title>
    <link rel="stylesheet" href="{% static 'last24h/style_unt.css' %}">

</head>

<body class="home blog mp6 customizer-styles-applied highlander-enabled highlander-light demo-site infinite-scroll">
	<div id="page" class="hfeed site">
				<div id="masthead-wrap">
			<header id="masthead" class="site-header" role="banner">
				<div id="logo">
										<h1 class="site-title"><a href="{% url 'last24h:index' %}" title="Untitled" rel="home">graphite <font color=#999 size='8px' face='Raleway'>- max relevance, min redundancy</font></a></h1><h1 class="site-title">  </h1>
									</div>
				<div class="nav-wrap">
					<nav role="navigation" class="site-navigation main-navigation">
						<h1 class="assistive-text">Menu</h1>
						<div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div>

						<div class="menu-short-container"><ul id="menu-short" class="menu"><li id="menu-item-132" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-132"><a href="{% url 'last24h:index' %}">â‰¤24h</a></li>
<li id="menu-item-133" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-133"><a href="{% url 'customsearch' %}">Custom search</a></li>
<li id="menu-item-135" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-135"><a href="{% url 'grews_alert' %}">alerts</a></li>
<li id="menu-item-133" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-133"><a href="{% url 'how_it_works' %}">How it works</a></li>
<li id="menu-item-136" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-136"><a href="{% with log_link|first as name %}{% url name %}{% endwith %}">{{log_inf|first}}</a></li>
<li id="menu-item-136" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-136">
<a href="{% with log_link|last as name %}{% url name %}{% endwith %}">{{log_inf|last}}</a>
</li>
</ul></div>					</nav><!-- .site-navigation -->
          
<script align='center' type="text/javascript" src="{% static 'last24h/d3.min.js' %}"></script> 
                    <script type='text/javascript' src="{% static 'last24h/fisheye.js' %}"> </script>

<script>

var width = 1000,
    height = 800;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(function(d){return (d.suggest <= 15) && (d.suggest != 0) ? -500 : -30;})
    .linkDistance(50)
    .size([width, height]);

var svg = d3.select("body").append("svg")
   // .attr("width", 0.8 * width)
  //  .attr("height", height);  

d3.json("{% with 'last24h/cs/cs_'|add:strin|add:'_nl.json' as user_query_path %}{% static user_query_path %}{% endwith %}", function(error, graph) {
  if (error) throw error;
    

  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();
    
  var node_positions = force.nodes()
  var link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
      .attr("class", "link")
      .style("stroke-width", 1.5);//function(d) { return 2*Math.sqrt(d.weight); });
     
    //  .on("dblclick", connectedNodes); 
  var circle = svg.append("g")
    .attr("class", "nodes")
  .selectAll("circle")
    .data(graph.nodes)
  .enter().append("circle")
    .call(force.drag)
      .style("opacity",function(d){return d.single ==1 ? 0:1;})
        .attr("r", function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? 6 :4;})
        .style("pointer-events",function(d){return (d.single == 1)? "none":"auto";}) 
        .style("fill", function(d) { return color(d.suggest); })
        .style("stroke",function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? '#ffff00' :'#fff';})
        .style("opacity",function(d){return (d.single == 1)? 0:1;})
        .on("mouseover", function(d) {
      
        
        pop.transition()
               .duration(500)
               .style("opacity", 0);
       pop.style("pointer-events","none");
        div.transition()
            .duration(200)   
            .style("opacity", .9);    
        div .html('<a href=' + d.url + '><b>' + d.title + '</b></a><br/><br/>' + d.summary + '...')   
            .style("left", (d3.event.pageX + 10)  + "px")             
            .style("top", (d3.event.pageY - 28) + "px");})
       .on("mouseout", function(d) {
            div.transition()        
                .duration(500)      
                .style("opacity", 0);})
       .on("mouseup", function(d) {
           div.transition()        
                .duration(500)      
                .style("opacity", 0);
            pop.transition()
                .duration(200)
                .style("opacity", .9)
                .style("pointer-events","auto");    
            pop .attr("id", "link")
                .html('<a href=' + d.url + '><b>' + d.title + '</b></a><br/><br/>' + d.summary + '...')        
                .style("left", (d3.event.pageX + 10) + "px")             
                .style("top", (d3.event.pageY - 28) + "px");
                });                         
    var opac_labels = 0.6;
    var label = svg.selectAll(".node")
          .data(graph.nodes)
          .enter().append("g")
          .attr("class", "labels")
          
        .style("pointer-events","none");
    

  
    label.append("rect")
    .style("opacity",function(d){return (d.single == 0 && d.suggest !=0 && d.keywords.length > 0) ? opac_labels:0;})


    .attr("id", function(d) {return d.suggest != 0 && d.suggest <= 15 ? "sugg":"nsugg";})
     // .attr("id", function(d) {return d.suggest != 0 && d.suggest <= 15 ? "sugg":"nsugg";})
    //.attr("id", function(d) {if(d.single == 0 && d.suggest != 0 && d.suggest <= 15) {return "sugg";} else if (d.single == 1 && d.suggest != 0 && du.suggest <= 15){return "ssugg";} else {return "nsugg";})
    .attr("x", function(d){return d.keywords.length > 0 ? -Math.max(d.keywords[0].length,d.keywords[d.keywords.length-1].length)*5 + "px":null;})
    .attr("y", function(d){return d.keywords.length > 0 ? d.keywords.length*-0.4 -1.1+ "em":null;})
    .attr("width", function(d){return d.keywords.length > 0 ? Math.max(d.keywords[0].length,d.keywords[d.keywords.length-1].length)*10 + "px":null;})
    .attr("height", function(d){return d.keywords.length + "em";})  
    .attr("fill", "white")
    .attr("rx","2px")
    .attr("ry","2px")
    .style("stroke-width","2px")
    .style("stroke",function(d) { return color(d.suggest); }); 
    
    label.append("text")
    .style("opacity",function(d){return (d.single == 0 && d.suggest !=0 && d.keywords.length > 0) ? opac_labels:0;})


    .attr("id", function(d) {return d.suggest != 0 && d.suggest <= 15 ? "sugg":"nsugg";})
      //.attr("id", function(d) {return d.suggest != 0 && d.suggest <= 15 ? "sugg":"nsugg";})
    //.attr("id", function(d) {if(d.single == 0 && d.suggest != 0 && d.suggest <= 15) {return "sugg";} else if (d.single == 1 && d.suggest != 0 && du.suggest <= 15){return "ssugg";} else {return "nsugg";})
    .attr("y", function(d){return d.suggest !=0 ? -d.keywords.length*0.4 - 1.8+ 'em':'1.35em';})
    .html(function(d) {if (d.suggest != 0) {var tex = "";
                           for (word in d.keywords){tex += "<tspan x='0' dy='1em' style='position:relative'>" + d.keywords[word] + "</tspan>";}}
                           else {var tex=null;}; 
                                                            return tex;})//(d.suggest <= 15) && (d.suggest != 0) ? d.title : null;});
        .style({"text-baseline":"middle","text-anchor":"middle"});
    

    
    var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 1e-6);
    
    var hover = 1;
    var no = 6;
    var pop = d3.select("body").append("pop")
    .attr("class", "popup")
    .style("opacity", 1e-6);
    
    var bottom_title = d3.select("bottom_box").html('<h1>Overview over this topic cluster</h1>')
    var bottom_box = d3.select("body").append("bottom_box").style("opacity", 0);
    
    var bsuggest1 = d3.select("bottom_box").append("bsuggest")
                .attr("class","bsuggest1")
                .style("opacity", 0);
    var bsuggest2 = d3.select("bottom_box").append("bsuggest")
                .attr("class","bsuggest2")
                .style("opacity", 0);
    var bsuggest3 = d3.select("bottom_box").append("bsuggest")
                .attr("class","bsuggest3")
                .style("opacity", 0);
                
    
    var box = d3.select("body").append("box");
    var freeze = 0;
    var release = 0;
    
    var suggest1 = d3.select("box").append("suggest").attr("class","suggestion").attr("id","suggest1")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"0:1"%}{{suggestion.images}}{% endfor %})"})//http://static.independent.co.uk/s3fs-public/thumbnails/image/2015/11/05/16/cameron.awkward2.JPG)"})
        .html("{% for suggestion in suggestions|slice:"0:1"%}<a href='{{suggestion.url}}'>1.'{{ suggestion.title }}'</a>{% endfor %}" ) 
        .on("mouseover", function() {if (freeze == 0) {no = 1; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =1;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest1.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});

    
        var suggest2 = d3.select("box").append("suggest").attr("class","suggestion").attr("id","suggest2")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"1:2"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"1:2"%}<a href='{{suggestion.url}}'>2.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 2; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =2;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest2.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});


    var suggest3 = d3.select("box").append("suggest").attr("id","suggest3")
    .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"2:3"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"2:3"%}<a href='{{suggestion.url}}'>3.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 3; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =3;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest3.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest4 = d3.select("box").append("suggest").attr("id","suggest4")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"3:4"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"3:4"%}'<a href='{{suggestion.url}}'>4.{{ suggestion.title }}</a>'{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 4; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =4;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest4.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest5 = d3.select("box").append("suggest").attr("id","suggest5")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"4:5"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"4:5"%}<a href='{{suggestion.url}}'>5.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 5; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =5;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest5.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest6 = d3.select("box").append("suggest").attr("id","suggest6")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"5:6"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"5:6"%}<a href='{{suggestion.url}}'>6.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 6; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =6;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest6.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
    
        var suggest7 = d3.select("box").append("suggest").attr("id","suggest7")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"6:7"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"6:7"%}<a href='{{suggestion.url}}'>7.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 7; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =7;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest7.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest8 = d3.select("box").append("suggest").attr("id","suggest8")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"7:8"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"7:8"%}<a href='{{suggestion.url}}'>8.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 8; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =8;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest8.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest9 = d3.select("box").append("suggest").attr("id","suggest9")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"8:9"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"8:9"%}<a href='{{suggestion.url}}'>9.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 9; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =9;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest9.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        var suggest10 = d3.select("box").append("suggest").attr("id","suggest10")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"9:10"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"9:10"%}<a href='{{suggestion.url}}'>10.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 10; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =10;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest10.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        
        var suggest11 = d3.select("box").append("suggest").attr("id","suggest11")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"10:11"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"10:11"%}<a href='{{suggestion.url}}'>11.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 11; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =11;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest11.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
    
        var suggest12 = d3.select("box").append("suggest").attr("id","suggest12")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"11:12"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"11:12"%}<a href='{{suggestion.url}}'>12.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 12; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =12;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest12.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
        
        var suggest13 = d3.select("box").append("suggest").attr("id","suggest13")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"12:13"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"12:13"%}<a href='{{suggestion.url}}'>13.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 13; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =13;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest13.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
    
        var suggest14 = d3.select("box").append("suggest").attr("id","suggest14")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"13:14"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"13:14"%}<a href='{{suggestion.url}}'>14.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 14; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =14;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest14.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
    
        var suggest15 = d3.select("box").append("suggest").attr("id","suggest15")
        .style({"background-color": color(Math.floor((Math.random() * 80) + 1)),"background-image": "url({% for suggestion in suggestions|slice:"14:15"%}{{suggestion.images}}{% endfor %})"})
        .html("{% for suggestion in suggestions|slice:"14:15"%}<a href='{{suggestion.url}}'>15.{{ suggestion.title }}</a>{% endfor %}" )
        .on("mouseover", function() {if (freeze == 0) {no = 15; focus_on();}})
        .on("click", function() {if (freeze == 0){freeze =15;var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;d3.selectAll("circle").filter(function(d){return d.comp != e.comp;}).style("pointer-events","none");suggest15.style("border-color",function(){return color(e.suggest);});} else  {d3.selectAll("circle").style("pointer-events","auto");d3.select("#suggest" + freeze).style("border-color","inherit");freeze = 0; focus_off();release = 1;}})
        .on("mouseout", function(){if (freeze==0 && release == 0) {return focus_off();} else if (freeze == 0 && release == 1){release = 0;}});
    var zoom_toggle = 0;
    
function focus_on() {
           var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__,
           f = d3.selectAll("circle").filter(function(d) {return e.comp == d.comp ? d : null;}),
           g = d3.selectAll("text").filter(function(d) {return e.comp == d.comp ? d : null;}),
           i = d3.selectAll("rect").filter(function(d) {return e.comp == d.comp ? d : null;}),
           h = d3.selectAll(".link").filter(function(d) {return e.comp == d.source.comp ? d : null;});
           circle.style("opacity", function (o) {if (e.comp == o.comp){return 1;} else if (singles==0 && o.single==1){return 0;} else if (singles==0 && o.single==0) {return 0.1;} else {return 0.1;}});
        d3.selectAll("rect").style("opacity", function (o) {if (e.comp == o.comp && titles != 2 && titles==1 && o.suggest <= 15 && o.suggest != 0){return opac_labels;} else if (e.comp == o.comp && titles != 2 && titles==0 && o.keywords.length>0 && o.suggest != 0){return opac_labels;} else if ( singles==0 && o.single==0 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return 0.1;} else if (singles==0 && o.single==0 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return 0.1;}  else if (singles==1 && o.single==1 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return 0.1;}  else if (singles==1 && o.single==1 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return 0.1;} else {return 0;}});
        d3.selectAll("text").style("opacity", function (o) {if (e.comp == o.comp && titles != 2 && titles==1 && o.suggest <= 15 && o.suggest != 0){return opac_labels;} else if (e.comp == o.comp && titles != 2 && titles==0 && o.keywords.length>0 && o.suggest != 0){return opac_labels;} else if ( singles==0 && o.single==0 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return 0.1;} else if (singles==0 && o.single==0 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return 0.1;}  else if (singles==1 && o.single==1 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return 0.1;}  else if (singles==1 && o.single==1 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return 0.1;} else {return 0;}});
        
           force.stop();
    //text.style("opacity",0.1);
           link.style("opacity", 0.1);
           h.style("opacity",1);
           f.transition().duration(200).attr("transform", function(d) { return "translate(" + (2*d.x + 500 - 2*e.x) + "," + ( 2*d.y + 200 -2*e.y) + ")"; }).attr("r", function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? 8 : 6;}).style("stroke", function(d) {return d.suggest == e.suggest ? "#ff0000": "#fff";})
           g.transition().duration(200).attr("transform", function(d) { return "translate(" + (2*d.x + 500 - 2*e.x) + "," + ( 2*d.y + 200 -2*e.y) + ")";});     
        i.transition().duration(200).attr("transform", function(d) { return "translate(" + (2*d.x + 500 - 2*e.x) + "," + ( 2*d.y + 200 -2*e.y) + ")";});  
           h.transition().duration(200).attr("x1", function(d) {return 2*d.source.x + 500 -2*e.x;}) 
                .attr("y1", function(d) {return 2*d.source.y + 200 - 2*e.y;})
                .attr("x2", function(d) {return 2*d.target.x + 500 -2*e.x;})
                .attr("y2", function(d) {return 2*d.target.y + 200 -2*e.y;}); 
            
//The bit for bsuggest
           bottom_box.transition().duration(200).style("opacity", 1).style("pointer-events",'auto');
           suggestionsss = d3.selectAll("circle").filter(function(d) {return (d.comp == e.comp)? this: null;}).sort(function(c,d){return d.suggest - e.suggest;});//&& (d.suggest != 0)? this : null;}); 
                if (suggestionsss[0].length >= 3) {
                    d3.select("bsuggest").style({"width": "25%", "float":"left"});
                        bsuggest1
                           // .style("width", 33%)
                            .html('<a href=' + suggestionsss[0][0].__data__.url + '><b>' + suggestionsss[0][0].__data__.title + '</b></a><br/><br/>' + suggestionsss[0][0].__data__.summary + '...')
                            .transition().duration(200).style("opacity", 1);
                        bsuggest2
                            .html('<a href=' + suggestionsss[0][1].__data__.url + '><b>' + suggestionsss[0][1].__data__.title + '</b></a><br/><br/>' + suggestionsss[0][1].__data__.summary + '...')
                           // .style("width", 33%)
                            .transition().duration(200).style("opacity", 1);
                        bsuggest3
                            .html('<a href=' + suggestionsss[0][2].__data__.url + '><b>' + suggestionsss[0][2].__data__.title + '</b></a><br/><br/>' + suggestionsss[0][2].__data__.summary + '...')
                           // .style("width", 200)
                            .transition().duration(200).style("opacity", 1);
                    }
                else if (suggestionsss.length == 2) {
                    bsuggest.style("width", "50%");
                    bsuggest1
                        .html('<a href=' + suggestionsss[0][0].__data__.url + '><b>' + suggestionsss[0][0].__data__.title + '</b></a><br/><br/><b>Description:</b>' + suggestionsss[0][0].__data__.summary + '...')
                      //  .style("width", 300)
                        .transition().duration(200).style("opacity", 1);
                    bsuggest2
                        .html('<a href=' + suggestionsss[0][1].__data__.url + '><b>' + suggestionsss[0][1].__data__.title + '</b></a><br/><br/><b>Description:</b>' + suggestionsss[0][1].__data__.summary + '...')
                     //   .style("width", 300)
                        .transition().duration(200).style("opacity", 1);
    
                    }
                else if (suggestionsss.length == 1) {
                    d3.select("bsuggest").style({"width": "50%","float":"center"});
                            
                    bsuggest1
                        .html('<a href=' + suggestionsss[0][0].__data__.url + '><b>' + suggestionsss[0][0].__data__.title + '</b></a><br/><br/><b>Description:</b>' + suggestionsss[0][0].__data__.summary + '...')
                 //       .attr("width", 600)
                        .transition().duration(200).style("opacity", 1);
                    }
       
    } //end focus_on
    
function focus_off() {
        var e = d3.selectAll("circle").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__,
        f = d3.selectAll("circle").filter(function(d) {return e.comp == d.comp ? d : null;}),
        g = d3.selectAll("text").filter(function(d) {return e.comp == d.comp ? d : null;}),
        i = d3.selectAll("rect").filter(function(d) {return e.comp == d.comp ? d : null;}),
        h = d3.selectAll(".link").filter(function(d) {return e.comp == d.source.comp ? d : null;});
        bottom_box.transition().duration(200).style("opacity", 0).style("pointer-events", "none");
        circle.style("opacity",function(d){if (singles==0){return d.single ==1 ? 0:1;} else {return 1;}});
        d3.selectAll("circle").style("stroke", function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? '#ffff00' :'#fff';});
        d3.selectAll("text").style("opacity", function (o) {if ( singles==0 && o.single==0 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return opac_labels;} else if (singles==0 && o.single==0 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return opac_labels;}  else if (singles==1 && o.single==1 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return opac_labels;}  else if (singles==1 && o.single==1 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return opac_labels;} else {return 0;}});
    d3.selectAll("rect").style("opacity", function (o) {if ( singles==0 && o.single==0 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return opac_labels;} else if (singles==0 && o.single==0 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return opac_labels;}  else if (singles==1 && o.single==1 && titles==1 && o.suggest <= 15 && o.suggest != 0) {return opac_labels;}  else if (singles==1 && o.single==1 && titles==0 && o.keywords.length>0 && o.suggest != 0) {return opac_labels;} else {return 0;}});
    
        link.style("opacity",1);
//            text.style("opacity",1);
        f.transition().duration(200).attr("r", function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? 4 :6;}).attr("transform", function(d) { return "translate(" + (d.x -d.px) + "," + (d.y -d.py) + ")"; });
        g.transition().duration(200).attr("transform", function(d) { return "translate(" + (d.x -d.px) + "," + (d.y -d.py) + ")";});
    i.transition().duration(200).attr("transform", function(d) { return "translate(" + (d.x -d.px) + "," + (d.y -d.py) + ")";});
        h.transition().duration(200).attr("x1", function(d) {return 2*d.source.px;}) //function(d) { return d.source.x + 500; })
            .attr("y1", function(d) {return 2*d.source.py;})//function(d) { return  d.source.y + 300; })
            .attr("x2", function(d) {return 2*d.target.px ;})//function(d) { return d.target.x + 500; })
            .attr("y2", function(d) {return 2*d.target.py;}); 
        force.resume();
        //zoom_toggle = 0;
    }//end focus_off
    
 //     resize();
 // d3.select(window).on("resize", resize); 
  
 

    var singles = 0;
    var titles = 0;
   d3.select('#singles').on('change', function() {
        if (this.value == "clusters") {singles = 0;
        d3.selectAll("circle").style("opacity",function(d){return d.single == 1? 0:1;}).style("pointer-events",function(d){return d.single == 1? "none":"auto";});
         d3.selectAll("rect").filter(function(d){return d.single ==1;}).style("opacity",0)
         d3.selectAll("text").filter(function(d){return d.single ==1;}).style("opacity",0) }                           
         
        else if (this.value == "singles") {
            singles=1;d3.selectAll("circle").style("opacity",1).style("pointer-events","auto");
           if (titles == 0){d3.selectAll("text").filter(function(d){return d.suggest !=0 && d.keywords.length > 0;}).style("opacity",opac_labels);d3.selectAll("rect").filter(function(d){return d.suggest !=0 && d.keywords.length > 0;}).style("opacity",opac_labels)}
            else if (titles ==1) {d3.selectAll("#sugg").style("opacity",opac_labels)}
           
           
           
        }
        });
    
    
   d3.select('#order').on('change', function() {
        var showTitles = function(d) { return (d.suggest <= 15) && (d.suggest != 0) ? d.title : null;};
        var showKeywords = function(d) { return d.keywords;};
        var noShow = '';
        if (this.value == "Keyword_check") {
            
                titles = 0;         d3.selectAll("rect").style("opacity",function(d){if (singles == 0 && d.single == 0 && d.suggest !=0 && d.keywords.length > 0) {return opac_labels;} else if (singles == 1 && d.suggest !=0 && d.keywords.length > 0){return opac_labels;} else {return 0;}});
d3.selectAll("text").style("opacity",function(d){if (singles == 0 && d.single == 0 && d.suggest !=0 && d.keywords.length > 0) {return opac_labels;} else if (singles == 1 && d.suggest !=0 && d.keywords.length > 0){return opac_labels;} else {return 0;}});
            
        d3.selectAll("text").attr("y", function(d){return d.suggest !=0 ? -d.keywords.length*0.4 - 1.8+ 'em':'1.35em';})
    .html(function(d) {if (d.suggest != 0) {var tex = "";
                           for (word in d.keywords){tex += "<tspan x='0' dy='1em' style='position:relative'>" + d.keywords[word] + "</tspan>";}}
                           else {var tex=null;}; 
                                                            return tex;})//(d.suggest <= 15) && (d.suggest != 0) ? d.title : null;});
        .style({"text-baseline":"middle","text-anchor":"middle"});            
            
        d3.selectAll("rect").attr("x", function(d){return d.keywords.length > 0 ? -d.keywords[0].length*5 + "px":null;})
    .attr("y", function(d){return d.keywords.length > 0 ? d.keywords.length*-0.4 -1.1+ "em":null;})
    .attr("width", function(d){return d.keywords.length > 0 ? d.keywords[0].length*10 + "px":null;})
    .attr("height", function(d){return d.keywords.length + "em";});  

        }
        else if (this.value == "Title_check") {          
            titles = 1;
            d3.selectAll("rect").style("opacity",0)
             d3.selectAll("text").style("opacity",0)
            if (singles == 0){
            d3.selectAll("rect").style("opacity",0)
             d3.selectAll("text").style("opacity",0)
            d3.selectAll("#sugg").filter(function(d){return d.single == 0}).style("opacity",opac_labels)}
            else {d3.selectAll("#sugg").filter(function(d){return d.single == 0}).style("opacity",opac_labels)}
            
            d3.selectAll("text").html(showTitles).style({"text-baseline":"right","text-anchor":"inherit"}).attr("x","12px").attr("y", "0.4em")
                                              
        d3.selectAll("rect")
            .attr("x", "10px")
    .attr("y", "-0.4em")
    .attr("width", function(d){return d.title.length*7+ "px";})
    .attr("height","1em") 
    
        
                                              
                                              
                                              }
        else if (this.value == 'None') {titles=2; d3.selectAll("rect").style("opacity",0);d3.selectAll("text").style("opacity",0);}
        });
   /* d3.select('#Keyword_check').on('change', function() {
        var showKeywords = function(d) { return d.suggest != 0  ? d.keywords[0]: '';};
        var noShow = '';
        /*var position = function(d) {vars = d.keywords[0]; return Math.round(vars.length/-2);};
        d3.selectAll(".circle text").attr("x",-10).text(this.checked ? showKeywords : noShow);
        });*/
            
  force.on("tick", function() {if (zoom_toggle == 0) {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
    circle.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    d3.selectAll("rect").attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
    d3.selectAll("text").attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
  
//  text.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })  
                  } //end of if
                              /* else if (zoom_toggle = 1) {
                                   link.attr("x1", function(d) {return e.comp == d.source.comp ? 2*d.source.x + 500 -2*e.x : d.source.x;}) 
        .attr("y1", function(d) {return e.comp == d.source.comp ? 2*d.source.y + 200 - 2*e.y: d.source.y;})
        .attr("x2", function(d) {return e.comp == d.source.comp ? 2*d.target.x + 500 -2*e.x: d.target.x;})
        .attr("y2", function(d) {return e.comp == d.source.comp ? 2*d.target.y + 200 -2*e.y: d.target.y;}); 
    node.attr("transform", function(d) { return e.comp == d.comp ? "translate(" + (d.x + 500 -e.x) + "," + (d.y + 200 - e.y) + ")":"translate(" + d.x + "," + d.y + ")"; }); 
                               
     text.attr("transform", function(d) { return e.comp == d.comp ? "translate(" + (d.x + 500 -e.x) + "," + (d.y + 200 - e.y) + ")":"translate(" + d.x + "," + d.y + ")"; });                      
                               
                               } //The factor of the node transformation has is incorrect. */       
                  });//end of force.on
    
    
    
    function resize() {
    width = window.innerWidth *0.8, height = window.innerHeight;
    svg.attr("width", width).attr("height", height);
    force.size([width, height]).resume();
  }
    
  var toggle = 0;
//Create an array logging what is connected to what

//This function looks up whether a pair are neighbours
                               
/*function connectedNodes() {
    if (toggle == 0) {
        
         e = d3.selectAll(".node").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;
        f = d3.selectAll("circle").filter(function(d) {return e.comp == d.comp ? d : null;});
            g = d3.selectAll("text").filter(function(d) {return e.comp == d.comp ? d : null;});
            
          node.style("opacity", 1);
   //     node.style("opacity", function (f) {
     //       return f in o ? 1 : 0.1;
         node.style("opacity", function (o) {
            return e.comp == o.comp ? 1 : 0.1;});
         
         f.transition().duration(200).attr("r", 7).attr("transform", function(d) { return "translate(" + (d.x + 500 - 2*e.x) + "," + ( d.y + 300 -2*e.y) + ")"; });
            g.transition().duration(200).attr("transform", function(d) { return "translate(" + (d.x + 500 - 2*e.x) + "," + ( d.y + 300 -2*e.y) + ")";}); 

        
        
        //Reduce the opacity of all but the neighbouring nodes
        e = d3.select(this).node().__data__;
    f = d3.selectAll("circle").filter(function(d) {return e.comp == d.comp ? d : null;});
                    g = d3.selectAll("text").filter(function(d) {return e.comp == d.comp ? d : null;});
            
          node.style("opacity", 1);
   //     node.style("opacity", function (f) {
     //       return f in o ? 1 : 0.1;
         node.style("opacity", function (o) {
            return e.comp == o.comp ? 1 : 0.1;});
         
         f.transition().duration(200).attr("r", 7).attr("transform", function(d) { return "translate(" + (d.x + 500 - 2*e.x) + "," + ( d.y + 300 -2*e.y) + ")"; });
            g.transition().duration(200).attr("transform", function(d) { return "translate(" + (d.x + 500 - 2*e.x) + "," + ( d.y + 300 -2*e.y) + ")";}); 
        
        //Reduce the op
        toggle = 1;
    } else {
        e = d3.selectAll(".node").filter(function(d) {return d.suggest == no ? this : null;}).node().__data__;
        f = d3.selectAll("circle").filter(function(d) {return e.comp == d.comp ? d : null;});
           g = d3.selectAll("text").filter(function(d) {return e.comp == d.comp ? d : null;});
          node.style("opacity", 1);
          d3.selectAll("circle").transition().duration(400).attr("r",4);
           link.style("opacity",1);
            f.transition().duration(200).attr("r",4).attr("transform", function(d) { return "translate(" + (d.x -d.px) + "," + (d.y -d.py) + ")"; });
           g.transition().duration(200).attr("transform", function(d) { return "translate(" + (d.x -d.px) + "," + (d.y -d.py) + ")";});
        toggle = 0;
    }
}*/
    
//}); // end of d3.json function
    
var fisheye = d3.fisheye.circular()
      .radius(200);
svg.on("mousemove", function() {if (freeze == 0){
      fisheye.focus(d3.mouse(this));
     // d3.selectAll(".node").each(function(d) { d.fisheye = fisheye(d); }).attr("transform", function(d) { return "translate(" + d.fisheye.x + "," + d.fisheye.y + ")"; });
       d3.selectAll("circle").each(function(d) {d.fisheye = fisheye(d);}).attr("r", function(d) {return (d.suggest <= 15) && (d.suggest != 0) ? d.fisheye.z *6 :d.fisheye.z *4;});
}});
                                    
arrangeLabels()    
    //Toggle stores whether the highlighting is on

function arrangeLabels() {
  var move = 1;
  while(move > 0) {
    move = 0;
    svg.selectAll("rect").filter(function(d){return d.length > 5})
       .each(function() {
         var that = this,
             a = this.getBoundingClientRect();
         svg.selectAll("rect").filter(function(d){return d.length > 5})
            .each(function() {
              if(this != that) {
                var b = this.getBoundingClientRect();
                if(((Math.abs(a.left - b.left) * 2 - a.width - b.width) < -10)   &&
                   ((Math.abs(a.top - b.top) * 2 - a.height - b.height)< -10))  {
                  // overlap, move labels
                  var dx = (Math.max(0, a.right - b.left) +
                           Math.min(0, a.left - b.right)) * 0.01,
                      dy = (Math.max(0, a.bottom - b.top) +
                           Math.min(0, a.top - b.bottom)) * 0.02,
                      tt = d3.transform(d3.select(this).attr("transform")),
                      to = d3.transform(d3.select(that).attr("transform"));
                  move += Math.abs(dx) + Math.abs(dy);
                
                  to.translate = [ to.translate[0] + dx, to.translate[1] + dy ];
                  tt.translate = [ tt.translate[0] - dx, tt.translate[1] - dy ];
                  d3.select(this).attr("transform", "translate(" + tt.translate + ")");
                  d3.select(that).attr("transform", "translate(" + to.translate + ")");
                  a = this.getBoundingClientRect();
                     }
                  }
                }); //.each
               }); //.each
                  }//while
                } //arrangeLabels
                     
});
    
    
    
    
</script>
                    				</div><!-- .nav-wrap -->
			</header><!-- #masthead -->
		</div><!-- #masthead-wrap -->
    </div> 
    <div id="masthead-wrap">
		<div class="colophon2" role="contentinfo" >
			<div class="site-info">
                    <div class=menu-left>
                        <p> Viewing options: <select id="order">
  <option value="Keyword_check">Show keywords (beta)</option>
  <option value="Title_check">Show suggestions</option>                   
  <option value="None">None</option> 
                        </select>         <select id="singles">
  <option value="clusters">Only clusters</option>
  <option value="singles">Incl. singles</option>                       
    </select></p>
    </div> 
                 
    <div class=menu-right>
 <form class = "index_form" action="{% url 'customsearch' %}" method="post">
    {% csrf_token %}
    {{ form }}
    <input type="submit" value="Create another graph" />
</form>
    </div>

			</div><!-- .site-info -->
		</div><!-- #colophon -->
    </div><!-- masthead-wrap-->

      	<div id="main" class="site-main">
		<div id="primary" class="content-area">
<h1 align=center class="page-title">Grews suggestion output for "{{topic_text}}":</h1><!-- .entry-header -->
             
			<div id="content" class="site-content" role="main"> 

                
                
{% if suggestions %}
    {% for suggestion in suggestions %}
				<article id="post-140" class="post-140 post type-post status-publish format-standard has-post-thumbnail sticky hentry category-photos post-thumb">
	
		<div class="single-thumbnail genericon genericon-link">
			
				<img width="300" height="168" src="{{suggestion.images}}" class="attachment-content-img wp-post-image" alt="dcp_2082-1440x400" />			
		</div><!-- .single-thumbnail -->
		<div class="header-wrapper">
						<div class="entry-meta">
				<span class="byline"> by <span class="author vcard"></span></span>							</div><!-- .entry-meta -->
						<header class="entry-header">
				<h1 class="entry-title"><a href="{{suggestion.url}}">{{ suggestion.title }}</a></h1>
			</header><!-- .entry-header -->

					</div><!-- .header-wrapper -->

	</article><!-- #post-## -->
      {% endfor %}      
           
{% else %}
    <p>No suggestions are available.</p>
{% endif %}
    

            </div>
        </div>
    </div>

    
    </body>
        	<div id="colophon-wrap">
		<footer id="colophon" class="site-footer" role="contentinfo">
			<div class="site-info">
								&copy; Copyright 2015, <a href="https://beingbutlumps.wordpress.com">Paul Bo&euml;s</a>.
                <a href="{% url 'about' %}">About</a>, <a href="{% url 'contact' %}">Contact</a>, <a href="{% url 'disclaimer' %}" rel="designer">Disclaimer/License</a>.			</div><!-- .site-info -->
		</footer><!-- #colophon -->
	</div><!-- #colophon-wrap -->
</html>





















